<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rollup 轻量化Library打包工具 | Actual_Chao</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.491af009.css" as="style"><link rel="preload" href="/assets/js/app.9d8f3547.js" as="script"><link rel="preload" href="/assets/js/4.13bd7c28.js" as="script"><link rel="preload" href="/assets/js/2.e137e48c.js" as="script"><link rel="preload" href="/assets/js/8.076ce93b.js" as="script"><link rel="prefetch" href="/assets/js/10.c025b323.js"><link rel="prefetch" href="/assets/js/11.aff30d24.js"><link rel="prefetch" href="/assets/js/12.8bb88809.js"><link rel="prefetch" href="/assets/js/13.79dbcd28.js"><link rel="prefetch" href="/assets/js/14.e167532a.js"><link rel="prefetch" href="/assets/js/15.f702e40f.js"><link rel="prefetch" href="/assets/js/16.35cb3a9e.js"><link rel="prefetch" href="/assets/js/17.f05d26a8.js"><link rel="prefetch" href="/assets/js/18.9df8e545.js"><link rel="prefetch" href="/assets/js/19.b2792608.js"><link rel="prefetch" href="/assets/js/20.c4c25256.js"><link rel="prefetch" href="/assets/js/21.1f74d6b6.js"><link rel="prefetch" href="/assets/js/22.7b0b9da6.js"><link rel="prefetch" href="/assets/js/23.1d82e3d6.js"><link rel="prefetch" href="/assets/js/24.d98f95ae.js"><link rel="prefetch" href="/assets/js/25.dbab62b8.js"><link rel="prefetch" href="/assets/js/26.c8dbe9ca.js"><link rel="prefetch" href="/assets/js/27.f2a9b031.js"><link rel="prefetch" href="/assets/js/28.ce06e913.js"><link rel="prefetch" href="/assets/js/29.afef0a84.js"><link rel="prefetch" href="/assets/js/3.ab6c8af4.js"><link rel="prefetch" href="/assets/js/30.03cb84de.js"><link rel="prefetch" href="/assets/js/31.26208ec5.js"><link rel="prefetch" href="/assets/js/32.4a882a30.js"><link rel="prefetch" href="/assets/js/33.63acdde4.js"><link rel="prefetch" href="/assets/js/34.b09e067b.js"><link rel="prefetch" href="/assets/js/35.d62092ad.js"><link rel="prefetch" href="/assets/js/36.1e071235.js"><link rel="prefetch" href="/assets/js/37.81a80712.js"><link rel="prefetch" href="/assets/js/38.d066480a.js"><link rel="prefetch" href="/assets/js/39.b0316480.js"><link rel="prefetch" href="/assets/js/40.913fed9b.js"><link rel="prefetch" href="/assets/js/41.3029db88.js"><link rel="prefetch" href="/assets/js/42.f8b5c583.js"><link rel="prefetch" href="/assets/js/43.abbd37b9.js"><link rel="prefetch" href="/assets/js/44.6d4a8651.js"><link rel="prefetch" href="/assets/js/5.afb84be4.js"><link rel="prefetch" href="/assets/js/6.4fa78674.js"><link rel="prefetch" href="/assets/js/7.c0e220fc.js"><link rel="prefetch" href="/assets/js/9.e1755c3d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.491af009.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Actual_Chao" class="logo"> <span class="site-name can-hide">Actual_Chao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/recent/" class="nav-link">
  近期文章
</a></div><div class="nav-item"><a href="/package/" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  工具
</a></div><div class="nav-item"><a href="/rsa/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="可视化" class="dropdown-title"><span class="title">可视化</span> <span class="arrow down"></span></button> <button type="button" aria-label="可视化" class="mobile-dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webgl/three/" class="nav-link">
  three
</a></li></ul></div></div><div class="nav-item"><a href="/map/" class="nav-link">
  地图
</a></div><div class="nav-item"><a href="https://github.com/actualchao/docs-vuepress-actualchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/recent/" class="nav-link">
  近期文章
</a></div><div class="nav-item"><a href="/package/" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link router-link-active">
  工具
</a></div><div class="nav-item"><a href="/rsa/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="可视化" class="dropdown-title"><span class="title">可视化</span> <span class="arrow down"></span></button> <button type="button" aria-label="可视化" class="mobile-dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webgl/three/" class="nav-link">
  three
</a></li></ul></div></div><div class="nav-item"><a href="/map/" class="nav-link">
  地图
</a></div><div class="nav-item"><a href="https://github.com/actualchao/docs-vuepress-actualchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tools</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tools/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/tools/babel.html" class="sidebar-link">babel7 介绍和配置</a></li><li><a href="/tools/devOps.html" class="sidebar-link">DevOps</a></li><li><a href="/tools/docker.html" class="sidebar-link">Docker 容器化镜像实例</a></li><li><a href="/tools/git.html" class="sidebar-link">Git 操作</a></li><li><a href="/tools/iterm.html" class="sidebar-link">iterm 终端工具</a></li><li><a href="/tools/nginx.html" class="sidebar-link">nginx 配置</a></li><li><a href="/tools/rollup.html" aria-current="page" class="active sidebar-link">rollup 轻量化Library打包工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/rollup.html#简介" class="sidebar-link">简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/rollup.html#why-is-rollup" class="sidebar-link">Why is rollup</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#构建工具对比" class="sidebar-link">构建工具对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#配置" class="sidebar-link">配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/rollup.html#安装rollup" class="sidebar-link">安装rollup</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#配置rollup插件" class="sidebar-link">配置rollup插件</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#插件是什么" class="sidebar-link" style="padding-left:3rem;">插件是什么</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#插件对象遵循的规范" class="sidebar-link" style="padding-left:3rem;">插件对象遵循的规范</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#插件执行顺序" class="sidebar-link" style="padding-left:3rem;">插件执行顺序</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#配置常用的插件" class="sidebar-link" style="padding-left:3rem;">配置常用的插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#问题总结" class="sidebar-link">问题总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/rollup.html#commonjs-插件和-babel7-配置" class="sidebar-link">commonjs 插件和 babel7+ 配置</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#解决方案一-配置babel" class="sidebar-link">解决方案一 配置babel</a></li><li class="sidebar-sub-header"><a href="/tools/rollup.html#解决方案二" class="sidebar-link">解决方案二</a></li></ul></li></ul></li><li><a href="/tools/shell.html" class="sidebar-link">Shell</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="轻量化library打包工具"><a href="#轻量化library打包工具" class="header-anchor">#</a> 轻量化Library打包工具</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <div class="custom-block tip"><p class="custom-block-title">本文引用参考文档地址</p> <ul><li><a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer"> Rollup 官方中文文档 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/6844903896830181383#heading-7" target="_blank" rel="noopener noreferrer"> rollup 搭建打包 JS <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/6844903713165803527" target="_blank" rel="noopener noreferrer"> rollup打包js的注意点 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/cbd48919a0cc" target="_blank" rel="noopener noreferrer"> babel 7 的使用的个人理解 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <p>Rollup 是一个 JavaScript 模块打包器，可以将小块代码编译成大块复杂的代码，例如 library 或应用程序。</p> <p>Rollup 对代码模块使用新的标准化格式，这些标准都包含在 JavaScript 的 ES6 版本中，而不是以前的特殊解决方案，如 CommonJS 和 AMD。ES6 模块可以使你自由、无缝地使用你最喜爱的 library 中那些最有用独立函数，而你的项目不必携带其他未使用的代码。ES6 模块最终还是要由浏览器原生实现，但当前 Rollup 可以使你提前体验。</p> <h3 id="why-is-rollup"><a href="#why-is-rollup" class="header-anchor">#</a> Why is rollup</h3> <p><code>Rollup</code> 着眼于未来，采用原生的<code>ES</code> 标准的模块机制进行构建，未来<code>ES</code> 规范肯定会由浏览器实现，也是JavaScript语言明确的发展方向。机制更加优于<code>CommonJS</code></p> <p><code>CommonJS</code> 是在<code>ES</code>规范之前被提出的一种暂时性性解决方案，是一种特殊的传统格式，</p> <p>相比较<code>ES</code>模块允许进行静态分析，从而实现像 tree-shaking 的优化，并提供诸如循环引用和动态绑定等高级功能</p> <p><code>Tree-shaking</code>, 也被称为 &quot;live code inclusion,&quot; 它是清除实际上并没有在给定项目中使用的代码的过程，但是它可以更加高效。</p> <h3 id="构建工具对比"><a href="#构建工具对比" class="header-anchor">#</a> 构建工具对比</h3> <table><thead><tr><th>打包工具</th> <th style="text-align:center;">体积</th> <th style="text-align:right;">注入代码</th> <th style="text-align:right;">code spliting</th> <th style="text-align:right;">dynamic import</th> <th style="text-align:right;">Tree-shaking</th></tr></thead> <tbody><tr><td>webpack</td> <td style="text-align:center;">large</td> <td style="text-align:right;">more</td> <td style="text-align:right;">✅</td> <td style="text-align:right;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>rollup</td> <td style="text-align:center;">small</td> <td style="text-align:right;">less</td> <td style="text-align:right;">❌</td> <td style="text-align:right;">❌</td> <td style="text-align:right;">✅</td></tr></tbody></table> <p>webpack 是一款强大的 <code>bundle</code> 构建工具，通过 <code>loader</code>机制可以处理各种类型的文件，良好的 <code>code splitting</code>和<code>dynamic import</code>支持使得<code>webpack</code> 成为了应用程序，单页应用的全能型的的打包工具。</p> <p>但是因为其打包体积相对较大，注入代码更多，没有良好的<code>Tree-shaking</code>所以在<code>Library</code> 的打包工作中，不如<code>rollup</code>打包的精简。</p> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p><code>rollup</code> 定位是一款轻量级的构建工具，其配置也相对很简单，但是由于不支持<code>CommonJs</code>，在配置<code>rollup-plugin-commonjs</code> 将<code>CommmonJS</code> 转化成<code>ES</code> 模块方式的时候，需要配置<code>babel</code> 转译</p> <p>由于<code>babel 7+</code>升级改动比较大，命名空间改动，市面上的教程大部分说的不够清楚，而且基本上停留在<code>babel 6</code>的配置，导致一直抛<code>(plugin commonjs) SyntaxError: Unexpected token</code></p> <p>在后文中会着力介绍这个部分，分析<code>babel 7+</code>配置以及各个<code>presets</code> 和<code>plugins</code> 的作用。</p> <h3 id="安装rollup"><a href="#安装rollup" class="header-anchor">#</a> 安装rollup</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install --save-dev rollup
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <p>在项目根目录创建<code>rollup.config.js</code>文件。</p> <p><code>rollup</code> 配置比较的简洁，一般包括<code>input</code>,<code>output</code>,<code>plugins</code>,<code>external</code></p> <p><a href="https://www.rollupjs.org/guide/en/#configuration-files" target="_blank" rel="noopener noreferrer">配置项参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>这是一段简单的配置文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'amapUpper'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> <span class="token string">'dist/amapUpper.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'umd'</span> <span class="token comment">//兼容模式</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@amap/amap-jsapi-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 配置引入的包是否要打包，在这里配置的会忽略掉，不打包到我们的程序里面</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当你的配置文件需要配置多个打包策略的时候，你还可以这样配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'main-a.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'dist/bundle-a.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'cjs'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'main-b.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      file<span class="token operator">:</span> <span class="token string">'dist/bundle-b1.js'</span><span class="token punctuation">,</span>
      format<span class="token operator">:</span> <span class="token string">'cjs'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      file<span class="token operator">:</span> <span class="token string">'dist/bundle-b2.js'</span><span class="token punctuation">,</span>
      format<span class="token operator">:</span> <span class="token string">'es'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>你还可以使用多个配置文件，使用<code>--config</code>来使用配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># pass a custom config file location to Rollup
rollup --config my.config.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>使用了<code>umd</code>模式必须指定<code>Name for UMD export</code></p></div> <h3 id="配置rollup插件"><a href="#配置rollup插件" class="header-anchor">#</a> 配置rollup插件</h3> <p>配置gollup 的plugin 类似babel 全部移植到了<code>@rollup</code>下,在官方提供的  一站式配置商店，可以下载所需的插件,
作用在于可维护学习被误导成本降低，更有利于长期维护。</p> <p><a href="https://github.com/rollup/plugins" target="_blank" rel="noopener noreferrer">@plugin 链接地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="插件是什么"><a href="#插件是什么" class="header-anchor">#</a> 插件是什么</h4> <p><code>rollup plugin</code> 是一个遵循<code>rollup</code>插件规范的<code>object</code>，一般通过一个工厂函数返回一个对象实现</p> <p>一段简单的示例：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'my-example'</span><span class="token punctuation">,</span> <span class="token comment">// this name will show up in warnings and errors</span>
    <span class="token function">resolveId</span> <span class="token punctuation">(</span> <span class="token parameter">source</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">===</span> <span class="token string">'virtual-module'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> source<span class="token punctuation">;</span> <span class="token comment">// this signals that rollup should not ask other plugins or check the file system to find this id</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span> <span class="token punctuation">(</span> <span class="token parameter">id</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'virtual-module'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'export default &quot;This is virtual!&quot;'</span><span class="token punctuation">;</span> <span class="token comment">// the source code for &quot;virtual-module&quot;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>然后在配置文件中引用该插件，在plugins中，传入执行返回的对象</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">import</span> myExample from <span class="token string">'myExample'</span>


plugins: <span class="token punctuation">[</span> myExample<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="插件对象遵循的规范"><a href="#插件对象遵循的规范" class="header-anchor">#</a> 插件对象遵循的规范</h4> <p>A Rollup plugin is an object with one or more of the <code>properties</code>, <code>build hooks</code>, and <code>output generation hooks</code></p> <ul><li><a href="https://www.rollupjs.org/guide/en/#properties" target="_blank" rel="noopener noreferrer">properties<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.rollupjs.org/guide/en/#build-hooks" target="_blank" rel="noopener noreferrer">build hooks 构建钩子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.rollupjs.org/guide/en/#output-generation-hooks" target="_blank" rel="noopener noreferrer">output generation hooks 输出钩子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="插件执行顺序"><a href="#插件执行顺序" class="header-anchor">#</a> 插件执行顺序</h4> <p>熟悉<code>webpack loader</code>机制的都应该知道<code>loader</code> 实际上是从右到左，自下而上执行的，在页头的<a href="#%E7%AE%80%E4%BB%8B"> rollup打包js的注意点 </a>里面提到的错误记录/错误2里面，类比<code>webpack loader</code>机制，
其实是一个错误的类比，实际上<code>rollup</code>的<code>plugin</code> 机制是从左往右，自上而下而下的执行顺序。</p> <p>一个测试例子</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">function</span> <span class="token function">myExample1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'my-example1'</span><span class="token punctuation">,</span> <span class="token comment">// this name will show up in warnings and errors</span>
    <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'111 resolve_______________-------------------------------------------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'111 load_______________-------------------------------------------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">myExample2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'my-example1'</span><span class="token punctuation">,</span> <span class="token comment">// this name will show up in warnings and errors</span>
    <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'222 resolve_______________-------------------------------------------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'222 load_______________-------------------------------------------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// other ids should be handled as usually</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> <span class="token string">'dist/test.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">myExample1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
    <span class="token function">myExample2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><div align="center"><img loading="lazy" src="/assets/img/rollup-log1.8b0b9079.png" alt="" style="width:100%;"></div> <p>可以看到<code>load</code>,<code>resolve</code> 钩子函数都是从左往右，自上而下而下的执行顺序。</p> <h4 id="配置常用的插件"><a href="#配置常用的插件" class="header-anchor">#</a> 配置常用的插件</h4> <p>下面介绍正常打包中需要用到的插件，和一般配置。</p> <ul><li><code>@rollup/plugin-json</code>    原<code>rollup-plugin-json</code></li> <li><code>@rollup/plugin-commonjs</code>    原<code>rollup-plugin-commonjs</code></li> <li><code>@rollup/plugin-node-resolve</code>     原<code>rollup-plugin-node-resolve</code></li> <li><code>rollup-plugin-terser</code></li></ul> <p>首先，需要作为开发依赖安装这些插件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i @rollup/plugin-json -D
npm i @rollup/plugin-commonjs -D
npm i @rollup/plugin-node-resolve -D
npm i rollup-plugin-terser -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后需要引用配置文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> json <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-json'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-commonjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> nodeResolve <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-node-resolve'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token comment">// 排除node_modules 下的文件</span>
      runtimeHelpers<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 防止生成多个 打包helper 函数</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="问题总结"><a href="#问题总结" class="header-anchor">#</a> 问题总结</h2> <h3 id="commonjs-插件和-babel7-配置"><a href="#commonjs-插件和-babel7-配置" class="header-anchor">#</a> commonjs 插件和 babel7+ 配置</h3> <p>在跟着<a href="#%E7%AE%80%E4%BB%8B"> rollup 搭建打包 JS </a>一文配置的过程中，用到的插件不是官方一站式插件提供的长期维护版本，遇到了 <code>rollup-plugin-commonjs</code> 插件打包报错的问题</p> <div align="center"><img loading="lazy" src="/assets/img/rollup-log2.b0c1d596.png" alt="[!] (plugin commonjs) SyntaxError: Unexpected token (25:8)" style="width:100%;"></div> <p>针对使用了放弃维护的<code>rollup-plugin-commonjs</code>插件的打包抛出的这个<code>SyntaxError</code>,可以有两种解决方案。推荐方案二。</p> <h3 id="解决方案一-配置babel"><a href="#解决方案一-配置babel" class="header-anchor">#</a> 解决方案一 配置babel</h3> <p>查找了很多资料都显示，应该是<code>babel</code> 配置问题,主要分为：</p> <ul><li><code>babel</code> 配置问题</li> <li><code>babel</code> 转译执行顺序问题</li></ul> <p>综合这些资料，这个报错应该是由于该commonjs 插件库 被移动到 <code>@rollup/plugin-commonjs</code>下维护，导致非长期维护版本缺少某些转译后的辅助函数，属性，导致抛出异常。</p> <p>所以需要<code>babel</code> 辅助编译之后才能正确执行<code>commonjs</code> 插件。</p> <p><strong>babel 配置的一些问题</strong></p> <p>由于<code>babel 7+</code>版本中，将babel 的各个库全部移植到了<code>@babel/***</code>下统一官方维护，而市面上大部分的<code>babel</code>教程实际上没有对这点进行详细说明，而且教程里安装<code>babel</code>组件的时候并没有指定版本，实际上导致可能安装了<strong>7+</strong> 版本的<code>babel</code>核心库，而安装了放弃维护的<code>babel-plugins-***</code>下的插件预设之类的。就会导致一系列的问题。</p> <p>这里要注意一下这个<code>@</code>这个符号，这个是只有<code>babel7</code>才特有的，<code>babel6</code>都木有，市面上大量代码都是基于6的所以要特别注意，安装的时候要使用
<code>npm install i -S @babel\cli</code> 而不能是<code>npm install i -S babel-cli</code>了
这是 <code>babel 7</code> 的一大调整，原来的 <code>babel-xx</code> 包统一迁移到<code>babel</code>域 下 - 域由 <code>@</code> 符号来标识</p> <div class="custom-block tip"><p class="custom-block-title">规划</p> <p>接下来会顺着这篇文章出一篇总结<code>babel 7</code>配置问题的 文章，加油吧！奥利给！！！</p> <p>目前可以参阅文章开头提到的 <a href="#%E7%AE%80%E4%BB%8B"> babel 7 的使用的个人理解 </a></p></div> <p><strong>配置</strong></p> <p>由于这里使用<code>@rollup/plugin-babel</code>,执行<code>babel</code> 转译 所以不需要安装<code>@babel/cli</code>命令行工具。</p> <p>首先我们需要安装：</p> <ul><li>babel核心包<code>@babel/core</code></li> <li>babel预设包<code>@babel/preset-env</code></li> <li>统一的模块化的helper<code>@babel/runtime</code></li> <li>helper 的自动化引入工具 <code>@babel/plugin-transform-runtime</code></li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> i -D @babel/core
<span class="token function">npm</span> i -D @babel/preset-env
<span class="token function">npm</span> i -D @babel/runtime
<span class="token function">npm</span> i -D @babel/plugin-transform-runtime
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后在项目根目录下创建<code>.babelrc</code>的配置文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;browsers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;not ie &lt;= 8&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>然后如果你用的是<code>rollup-plugin-commonjs</code>非常期维护版本的插件的话，由于和<code>babel</code>有依赖关系,你需要：</p> <p>在<code>commonjs</code>插件之前引入<code>babel</code>插件，并配置需要匹配编译的文件，目录。和编译配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> <span class="token string">'src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'amapUpper'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> <span class="token string">'dist/amapUpper.js'</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token string">'/node_modules/**'</span><span class="token punctuation">,</span> <span class="token comment">// 排除node_modules 下的文件</span>
      runtimeHelpers<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 与plugin-transform-runtime 插件对应配置，生成统一化helper。</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="解决方案二"><a href="#解决方案二" class="header-anchor">#</a> 解决方案二</h3> <p>使用<code>rollup</code>新的官方提供的移动后的一站式插件库里面的插件</p> <p><a href="https://github.com/rollup/plugins" target="_blank" rel="noopener noreferrer">rollup @plugin 链接地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>使用了新的插件库之后，<code>babel</code>还是需要配置的，只是解决了<code>commonjs</code> 插件依赖<code>babel</code>的问题。</p> <p>而babel 实际上是解决各种浏览器，引擎之间的差异，而存在的。所以为了更好的支持，需要配备良好的babel配置。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tools/nginx.html" class="prev">
        nginx 配置
      </a></span> <span class="next"><a href="/tools/shell.html">
        Shell
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9d8f3547.js" defer></script><script src="/assets/js/4.13bd7c28.js" defer></script><script src="/assets/js/2.e137e48c.js" defer></script><script src="/assets/js/8.076ce93b.js" defer></script>
  </body>
</html>
