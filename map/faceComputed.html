<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简单重叠实心多边形的交集/并集计算 | Actual_Chao</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/css/0.styles.491af009.css" as="style"><link rel="preload" href="/assets/js/app.9d8f3547.js" as="script"><link rel="preload" href="/assets/js/4.13bd7c28.js" as="script"><link rel="preload" href="/assets/js/2.e137e48c.js" as="script"><link rel="preload" href="/assets/js/20.c4c25256.js" as="script"><link rel="prefetch" href="/assets/js/10.c025b323.js"><link rel="prefetch" href="/assets/js/11.aff30d24.js"><link rel="prefetch" href="/assets/js/12.8bb88809.js"><link rel="prefetch" href="/assets/js/13.79dbcd28.js"><link rel="prefetch" href="/assets/js/14.e167532a.js"><link rel="prefetch" href="/assets/js/15.f702e40f.js"><link rel="prefetch" href="/assets/js/16.35cb3a9e.js"><link rel="prefetch" href="/assets/js/17.f05d26a8.js"><link rel="prefetch" href="/assets/js/18.9df8e545.js"><link rel="prefetch" href="/assets/js/19.b2792608.js"><link rel="prefetch" href="/assets/js/21.1f74d6b6.js"><link rel="prefetch" href="/assets/js/22.7b0b9da6.js"><link rel="prefetch" href="/assets/js/23.1d82e3d6.js"><link rel="prefetch" href="/assets/js/24.d98f95ae.js"><link rel="prefetch" href="/assets/js/25.dbab62b8.js"><link rel="prefetch" href="/assets/js/26.c8dbe9ca.js"><link rel="prefetch" href="/assets/js/27.f2a9b031.js"><link rel="prefetch" href="/assets/js/28.ce06e913.js"><link rel="prefetch" href="/assets/js/29.afef0a84.js"><link rel="prefetch" href="/assets/js/3.ab6c8af4.js"><link rel="prefetch" href="/assets/js/30.03cb84de.js"><link rel="prefetch" href="/assets/js/31.26208ec5.js"><link rel="prefetch" href="/assets/js/32.4a882a30.js"><link rel="prefetch" href="/assets/js/33.63acdde4.js"><link rel="prefetch" href="/assets/js/34.b09e067b.js"><link rel="prefetch" href="/assets/js/35.d62092ad.js"><link rel="prefetch" href="/assets/js/36.1e071235.js"><link rel="prefetch" href="/assets/js/37.81a80712.js"><link rel="prefetch" href="/assets/js/38.d066480a.js"><link rel="prefetch" href="/assets/js/39.b0316480.js"><link rel="prefetch" href="/assets/js/40.913fed9b.js"><link rel="prefetch" href="/assets/js/41.3029db88.js"><link rel="prefetch" href="/assets/js/42.f8b5c583.js"><link rel="prefetch" href="/assets/js/43.abbd37b9.js"><link rel="prefetch" href="/assets/js/44.6d4a8651.js"><link rel="prefetch" href="/assets/js/5.afb84be4.js"><link rel="prefetch" href="/assets/js/6.4fa78674.js"><link rel="prefetch" href="/assets/js/7.c0e220fc.js"><link rel="prefetch" href="/assets/js/8.076ce93b.js"><link rel="prefetch" href="/assets/js/9.e1755c3d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.491af009.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Actual_Chao" class="logo"> <span class="site-name can-hide">Actual_Chao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/recent/" class="nav-link">
  近期文章
</a></div><div class="nav-item"><a href="/package/" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/rsa/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="可视化" class="dropdown-title"><span class="title">可视化</span> <span class="arrow down"></span></button> <button type="button" aria-label="可视化" class="mobile-dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webgl/three/" class="nav-link">
  three
</a></li></ul></div></div><div class="nav-item"><a href="/map/" class="nav-link router-link-active">
  地图
</a></div><div class="nav-item"><a href="https://github.com/actualchao/docs-vuepress-actualchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/recent/" class="nav-link">
  近期文章
</a></div><div class="nav-item"><a href="/package/" class="nav-link">
  我的开源
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  HTTP
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/rsa/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="可视化" class="dropdown-title"><span class="title">可视化</span> <span class="arrow down"></span></button> <button type="button" aria-label="可视化" class="mobile-dropdown-title"><span class="title">可视化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webgl/three/" class="nav-link">
  three
</a></li></ul></div></div><div class="nav-item"><a href="/map/" class="nav-link router-link-active">
  地图
</a></div><div class="nav-item"><a href="https://github.com/actualchao/docs-vuepress-actualchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Map</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/map/" aria-current="page" class="sidebar-link">目录</a></li><li><a href="/map/faceComputed.html" aria-current="page" class="active sidebar-link">简单重叠实心多边形的交集/并集计算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/map/faceComputed.html#业务场景" class="sidebar-link">业务场景</a></li><li class="sidebar-sub-header"><a href="/map/faceComputed.html#思路" class="sidebar-link">思路</a></li><li class="sidebar-sub-header"><a href="/map/faceComputed.html#流程" class="sidebar-link">流程</a></li><li class="sidebar-sub-header"><a href="/map/faceComputed.html#实现" class="sidebar-link">实现</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="业务场景"><a href="#业务场景" class="header-anchor">#</a> 业务场景</h2> <p>先说说背景吧，之前在业务中实际上接触了某市街道网格数据，但是只有街道网格数据，当时就在想如何求解社区数据。后来衍生到如何求解网格数据交集并集。百度过程中发现沈阳工业大学的的一篇论文，</p> <ul><li><a href="http://read.pudn.com/downloads90/doc/project/344041/%B4%F8%BF%D7%B6%B4%B5%C4%B6%E0%B1%DF%D0%CE%C7%F3%BD%BB%BC%AF%CB%E3%B7%A8.pdf" target="_blank" rel="noopener noreferrer"> 带孔洞的多边形求交集算法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>想到业务中可能会存在面的切割，求交，求并方法，高德地图目前并没有提供这些方法。于是查询相关的库的实现。其实有一部分想法是自己想实现一个几何图形的编辑类库，<strong>Too Young too simple!!!!</strong>
一顿百度搜索猛如虎，实际上查到有效的库并不多，嗯   顿时觉得机会来了。</p> <ul><li><a href="https://juejin.im/post/6844904159641075726" target="_blank" rel="noopener noreferrer"> 基于Turf.js教你快速实现地理围栏的合并拆分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h2> <p>需要了解的数学知识</p> <ul><li>法向量，是一条垂直于面的法向量，对于逆时针顺序的有序点集合，法向量为正直，对于顺时针法向量为负值</li> <li>法向量通过向量叉积求的，A x B 为负值，实际几何意义为A向量在B 向量的逆时针方向上，反之。</li> <li>面的面积可以通过法向量和求解，法向量和为正，有序数组为顺时针排列</li></ul> <h2 id="流程"><a href="#流程" class="header-anchor">#</a> 流程</h2> <p>在<strong>带孔洞的多边形求交集算法</strong>中的实心面的求交中，总结下来分为以下流程</p> <ul><li>一般吧多边形表示为环，一组有序点的集合。定义为二维数组，存放顶点数据，</li> <li>环的顶点集合应该采用二维笛卡尔，符合右手法则，即右手握拳，逆时针转动，Z轴指向屏幕面向自己的方向</li> <li>交点是产生新边界的关键，必须求出所有交点的值</li> <li>把交点分别插入两个环中，并记录该点是出点还是入点。并记录出点对应另一个面的入点索引。</li> <li>查找集合，经过一个出点 ==&gt; 入点/跳转另一个面出点 ==&gt;入点/跳转另一个面出点 这样的循环过程，就可以求交求并。</li></ul> <h2 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h2> <div class="custom-block danger"><p class="custom-block-title">浮点数问题</p> <p>通过上面的分析，这是一个复杂的数学求解过程，必然涉及到的就有浮点型小数的问题，需要通过有效小数问题尽量规避问题</p></div> <p>定义浮点小数计算方法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 通过保留有效小数实现解决浮点数问题</span>
<span class="token keyword">const</span> _ignoreFloatNum <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">function</span> <span class="token function">_toFixed</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span>_ignoreFloatNum<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>首先需要满足二维笛卡尔坐标的要求，把坐标转换为逆时针有序数组,通过计算所有三角形面的法相和，负值为逆时针，正为顺时针，返回整理后的有序集合</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 校验面数据点位顺逆方向，返回方向后的数据
 * 通过法相和/叉积和判断顺时针还是逆时针
 * @param {Array2} list 点位二维数组
 * @param {Boolean} clockLeft 是否返回逆时针
 */</span>
<span class="token keyword">function</span> <span class="token function">clockComputed</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> clockLeft <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 面数据不少于三个点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token comment">// 记录叉积和，即法相Z</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_p
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_p
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_p
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">_toFixed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y0<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    count <span class="token operator">+=</span> res
  <span class="token punctuation">}</span>

  <span class="token comment">// 叉积为0 则点在一条直线上</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'所有点在一条直线上'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">if</span> <span class="token punctuation">(</span>clockLeft<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//逆时针，面积为正值</span>
    <span class="token keyword">return</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> list <span class="token operator">:</span> list<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 顺时针</span>
    <span class="token keyword">return</span> count <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> list <span class="token operator">:</span> list<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>对两个面的求交求并，首先需要查找交点，生成出入信息。然后循环的取出点信息</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 
 * @param {Array} listA 实心面A
 * @param {Array} listB 实心面B
 */</span>
<span class="token keyword">function</span> <span class="token function">Intersection</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// const faceA = [[0, 0], [5, 0], [5, 5], [0, 5]]</span>
  <span class="token comment">// const faceB = [[2.5, 2.5], [10, 2.5], [10, 10], [2.5, 5]]</span>

  <span class="token comment">// const faceA = [[0, 0], [1, 0], [2, 2], [1, 3], [0, 3]]</span>
  <span class="token comment">// const faceB = [[3, 0], [1, 0], [1, 2], [1, 3], [3, 3]]</span>

  <span class="token comment">// const faceA = [[0, 0], [5, 0], [5, 10], [0, 10]]</span>
  <span class="token comment">// const faceB = [[5, 0], [10, 0], [10, 10], [5, 10], [8, 5]]</span>

  <span class="token comment">// const faceA = [[0, 0], [3, 0], [3, 3], [0, 3]]</span>
  <span class="token comment">// const faceB = [[2, 0], [6, 0], [6, 6], [2, 3]]</span>

  <span class="token keyword">const</span> faceA <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> faceB <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>


  <span class="token comment">// 生成记录交点信息的数据</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>_faceA<span class="token punctuation">,</span> _faceB<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">insertPointOfTwoFace</span><span class="token punctuation">(</span>faceA<span class="token punctuation">,</span> faceB<span class="token punctuation">)</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_faceA<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'--------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_faceB<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 查找可以开始的第一个点</span>
  <span class="token comment">// 正值开始，求并，对应循环里的判断正值，实际上循环是一个 正 ==&gt; 负/正 ==&gt; 负</span>
  <span class="token comment">// 负值开始，求交，对应循环里的判断为负值，实际上循环是一个 fu ==&gt; 正/负 ==&gt; 正</span>
  <span class="token keyword">const</span> _aIdx <span class="token operator">=</span> _faceA<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span>normal <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token comment">// 循环取点过程</span>
  <span class="token keyword">function</span> <span class="token function">getRes</span> <span class="token punctuation">(</span><span class="token parameter">aIdx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> aIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _faceA<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 拿到交点</span>
      <span class="token keyword">const</span> pA <span class="token operator">=</span> _faceA<span class="token punctuation">[</span>i <span class="token operator">%</span> _faceA<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
      <span class="token comment">// 如果遇到反向值，开始循环面B，并打断A循环，否则添加数据</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pA<span class="token punctuation">.</span>normal <span class="token operator">?</span> pA<span class="token punctuation">.</span>normal <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> bIdx <span class="token operator">=</span> pA<span class="token punctuation">.</span>bIndex
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> bIdx<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> _faceB<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> pB <span class="token operator">=</span> _faceB<span class="token punctuation">[</span>j <span class="token operator">%</span> _faceB<span class="token punctuation">.</span>length<span class="token punctuation">]</span>
          <span class="token comment">// 再次远到反向值，获取对应A 的索引，判断是否是开始索引，不是开始下一循环，直到到起点，</span>
          <span class="token comment">// 否则添加数据</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>pB<span class="token punctuation">.</span>normal <span class="token operator">?</span> pB<span class="token punctuation">.</span>normal <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> aIdx2 <span class="token operator">=</span> pB<span class="token punctuation">.</span>aIndex
            <span class="token keyword">if</span> <span class="token punctuation">(</span>aIdx2 <span class="token operator">!==</span> _aIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">getRes</span><span class="token punctuation">(</span>aIdx2<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pB<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pA<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">getRes</span><span class="token punctuation">(</span>_aIdx<span class="token punctuation">)</span>


  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'-----------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>接下来则需要实现的就是我们的插入交点信息的方法，该方法接受有序点集合，返回生成的带交点信息的有序集合</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 求实心面A 和实心面B 的交点并生成该交点的法向量Z,标记了出口还是入口，负值为入口（进入内部），正值为出口（从内部出去）
 * @param {Array} listA 实心面A
 * @param {Array} listB 实心面B
 */</span>
<span class="token keyword">function</span> <span class="token function">insertPointOfTwoFace</span> <span class="token punctuation">(</span><span class="token parameter">listA<span class="token punctuation">,</span> listB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 生成可记录对象</span>
  listA <span class="token operator">=</span> listA<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> _p<span class="token operator">:</span> item<span class="token punctuation">,</span> normal<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  listB <span class="token operator">=</span> listB<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> _p<span class="token operator">:</span> item<span class="token punctuation">,</span> normal<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 把点转换为逆时针数组</span>
  listA <span class="token operator">=</span> <span class="token function">clockComputed</span><span class="token punctuation">(</span>listA<span class="token punctuation">)</span><span class="token punctuation">;</span>
  listB <span class="token operator">=</span> <span class="token function">clockComputed</span><span class="token punctuation">(</span>listB<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 遍历面A，拿到索引为i和i++点的线段，超出则闭环连接到起始点</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> listA<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> listA<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> lineA <span class="token operator">=</span> <span class="token punctuation">[</span>listA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">,</span> listA<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">]</span>

    <span class="token comment">// 记录点在最后生成的带交点的面中的索引index</span>
    listA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_aIndex <span class="token operator">=</span> i

    <span class="token comment">// 遍历面B，生成线段，记录索引</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> listB<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> listB<span class="token punctuation">.</span>length
      <span class="token keyword">const</span> lineB <span class="token operator">=</span> <span class="token punctuation">[</span>listB<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">,</span> listB<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">]</span>

      listB<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>_bIndex <span class="token operator">=</span> j

      <span class="token comment">// 获得线段与线段交点，null 为不想交</span>
      <span class="token keyword">const</span> point <span class="token operator">=</span> <span class="token function">getPoint</span><span class="token punctuation">(</span>lineA<span class="token punctuation">,</span> lineB<span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>point<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 入口判断下个向量是不是马上出去，是的话忽略</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>point<span class="token punctuation">.</span>normal <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> lineC <span class="token operator">=</span> <span class="token punctuation">[</span>listB<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">,</span> listB<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> lineB<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">]</span>
          <span class="token keyword">const</span> lastNormal <span class="token operator">=</span> <span class="token function">getNormal</span><span class="token punctuation">(</span>lineA<span class="token punctuation">,</span> lineC<span class="token punctuation">)</span>
          

          <span class="token comment">//这里需要增加入点即出点的情况</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 用于记录插入交点的索引</span>
        <span class="token keyword">let</span> aIndex <span class="token operator">=</span> m
        <span class="token keyword">let</span> bIndex <span class="token operator">=</span> n

        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token punctuation">(</span>listA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>listA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 这里不进，因为获取交点时排除了起点为交点</span>

          <span class="token comment">// 如果交点是起点，直接记录法相，交点索引不需要更新</span>
          listA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>normal <span class="token operator">=</span> point<span class="token punctuation">.</span>normal
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>listA<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>listA<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

          <span class="token comment">// 交点是终点，记录法相，更新交点索引</span>
          listA<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>normal <span class="token operator">=</span> point<span class="token punctuation">.</span>normal
          aIndex <span class="token operator">=</span> m
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 否则在线段之间插入交点，更新记录的索引 </span>
          <span class="token comment">// ++i 之后 i就是新的索引</span>
          listA<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>point<span class="token punctuation">,</span> _aIndex<span class="token operator">:</span> m <span class="token punctuation">}</span><span class="token punctuation">)</span>
          i<span class="token operator">++</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>listB<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>listB<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 这里不进，因为获取交点时排除了起点为交点</span>

          listB<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> point<span class="token punctuation">.</span>normal
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>listB<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>listB<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> point<span class="token punctuation">.</span>_p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          listB<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> point<span class="token punctuation">.</span>normal
          bIndex <span class="token operator">=</span> n
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          listB<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>point<span class="token punctuation">,</span> normal<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> point<span class="token punctuation">.</span>normal<span class="token punctuation">,</span> _bIndex<span class="token operator">:</span> n <span class="token punctuation">}</span><span class="token punctuation">)</span>
          j<span class="token operator">++</span>
        <span class="token punctuation">}</span>


        <span class="token comment">// 双向记录交点对应另外一个面的起点索引</span>
        listA<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>bIndex <span class="token operator">=</span> bIndex
        listB<span class="token punctuation">[</span>bIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>aIndex <span class="token operator">=</span> aIndex

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>listA<span class="token punctuation">,</span> listB<span class="token punctuation">]</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p>然后要实现的就是基础的求交点，求法相的方法。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 获取法相normal Z
 */</span>
<span class="token keyword">function</span> <span class="token function">getNormal</span> <span class="token punctuation">(</span><span class="token parameter">lineA<span class="token punctuation">,</span> lineB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> lineA
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x3<span class="token punctuation">,</span> y3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x4<span class="token punctuation">,</span> y4<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> lineB

  <span class="token keyword">return</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y4 <span class="token operator">-</span> y3<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x4 <span class="token operator">-</span> x3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 求两个向量是否有交点有则返回点和点的法向量z，没有返回null
 * @param {Array} lineA 向量A
 * @param {Array} lineB 向量B
 */</span>
<span class="token keyword">function</span> <span class="token function">getPoint</span> <span class="token punctuation">(</span><span class="token parameter">lineA<span class="token punctuation">,</span> lineB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> lineA
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x3<span class="token punctuation">,</span> y3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x4<span class="token punctuation">,</span> y4<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> lineB


  <span class="token comment">// 求解两条直线的交点</span>
  <span class="token keyword">const</span> x0 <span class="token operator">=</span> <span class="token function">_toFixed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">*</span> y2 <span class="token operator">-</span> y1 <span class="token operator">*</span> x2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x3 <span class="token operator">-</span> x4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x3 <span class="token operator">*</span> y4 <span class="token operator">-</span> y3 <span class="token operator">*</span> x4<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> x2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y3 <span class="token operator">-</span> y4<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>x3 <span class="token operator">-</span> x4<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> y0 <span class="token operator">=</span> <span class="token function">_toFixed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">*</span> y2 <span class="token operator">-</span> y1 <span class="token operator">*</span> x2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y3 <span class="token operator">-</span> y4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x3 <span class="token operator">*</span> y4 <span class="token operator">-</span> y3 <span class="token operator">*</span> x4<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> x2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y3 <span class="token operator">-</span> y4<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>x3 <span class="token operator">-</span> x4<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// console.log(x0,y0);</span>

  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token comment">// 判断点在不在线上第三个参数固定了线段起点不可能设置为和其他线段交点，实际上排除了同一个点作为起点和终点被多次添加交点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pointIsOnLine</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span><span class="token punctuation">,</span> lineA<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">pointIsOnLine</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span><span class="token punctuation">,</span> lineB<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> normal <span class="token operator">=</span> <span class="token function">getNormal</span><span class="token punctuation">(</span>lineA<span class="token punctuation">,</span> lineB<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token punctuation">{</span> _p<span class="token operator">:</span> <span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span><span class="token punctuation">,</span> normal <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// console.log(res);</span>


  <span class="token keyword">return</span> res


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>求解交点的过程中，需要满足交点要在两个线段上，才能算是交点，为了避免端点重复添加的问题，这里把起点没有算在线段内</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 判断点在不在线上
 * @param {Array} point [x,y]
 * @param {Array2} line  [[x,y],[x,y]]
 * @param {Boolean} ignoreStart 忽略起点在起点上的情况
 * @param {Boolean} needOnArea 是否需要必须在线段内
 * 
 */</span>
<span class="token keyword">function</span> <span class="token function">pointIsOnLine</span> <span class="token punctuation">(</span><span class="token parameter">point<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ignoreStart <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> needOnArea <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span> <span class="token operator">=</span> point
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> line

  <span class="token comment">// 点为向量line 的起点时，该计算因x0，x1相等，y0 = y1 所以不能判断在不在线上</span>
  <span class="token comment">// 计算通过计算点和线段起点的斜率，和线段斜率是否相等</span>
  <span class="token keyword">let</span> onLine <span class="token operator">=</span> <span class="token function">_toFixed</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y0 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x0 <span class="token operator">-</span> x1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">_toFixed</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 实际上在计算时有时候需要起点不算在内，终点算在内，能避免重复取点问题</span>
  <span class="token comment">// 引入ignoreStart，为true时，起点算在内，为false 时，起点不算在向量上，默认不算，避免重复添加</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignoreStart <span class="token operator">&amp;&amp;</span> x0 <span class="token operator">==</span> x1 <span class="token operator">&amp;&amp;</span> y0 <span class="token operator">==</span> y1<span class="token punctuation">)</span> <span class="token punctuation">{</span> onLine <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>

  <span class="token comment">// 判断在不在区域内，不在的话false</span>
  <span class="token keyword">const</span> onArea <span class="token operator">=</span> x0 <span class="token operator">&gt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> x0 <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> y0 <span class="token operator">&gt;=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> y0 <span class="token operator">&lt;=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>

  <span class="token comment">// 如果需要必须在线段上，需同时满足online&amp;&amp;onArea，否则返回在不在直线上</span>
  <span class="token keyword">return</span> needOnArea <span class="token operator">?</span> onLine <span class="token operator">&amp;&amp;</span> onArea <span class="token operator">:</span> onLine
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>然后执行<code>Intersection</code>方法，就能得到求解的交集。</p> <p>脑力有限，还不能处理岛式交集，复杂情况也有很多限制，共边不交的形状，会拿到共边线段，需要通过索引判断是否为连续索引区分是不是交集多边形。</p> <p>该方法历时一天，实现了简单重叠多边形求交求并的实现，但是后续的边界情况逻辑复杂。</p> <p>进一步思考，通过碰撞检测方法可能会能够实现更加完整的实现。</p> <p>so ！！！ do it next time。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/map/" class="prev router-link-active">
        目录
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9d8f3547.js" defer></script><script src="/assets/js/4.13bd7c28.js" defer></script><script src="/assets/js/2.e137e48c.js" defer></script><script src="/assets/js/20.c4c25256.js" defer></script>
  </body>
</html>
